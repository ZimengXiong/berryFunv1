# Session: peppy-soaring-goblet

**Session ID**: `38aa7f74-459e-4fd6-9c68-034e029e5be4`

---

## User Prompts

### 1. 2026-02-01 09:48

Implement the following plan:

# Implementation Plan: Separate Cash and Zelle Verification

## Summary
Create two independent pending receipts when a user selects the "cash" payment option:
1. **Zelle Deposit Receipt** - Has uploaded image, $50/week deposit
2. **Cash Balance Receipt** - No image, remaining amount to collect in person

Both appear in admin queue and can be verified independently.

---

## Files to Modify

| File | Purpose |
|------|---------|
| `convex/schema.ts` | Make `storageId` optional, add `receiptType` and `relatedReceiptId` fields |
| `convex/receipts.ts` | Create both receipts when cash option selected |
| `src/components/checkout/ReceiptUpload.tsx` | Pass `cashBalanceAmount` to mutation |
| `src/components/admin/receipts/ReceiptQueue.tsx` | Visual distinction for cash vs Zelle |
| `src/components/admin/receipts/ReceiptReview.tsx` | Handle cash receipts (no image to show) |
| `convex/admin.ts` | Handle already-verified ledgerItems on second receipt verification |

---

## Implementation Steps

### 1. Schema Changes (`convex/schema.ts`)

```typescript
receipts: defineTable({
  // ...existing fields...
  storageId: v.optional(v.id("_storage")),  // Change: make optional
  receiptType: v.union(v.literal("zelle"), v.literal("cash")),  // NEW
  relatedReceiptId: v.optional(v.id("receipts")),  // NEW: links paired receipts
  // ...rest unchanged...
})
  .index("by_receiptType", ["receiptType"])  // NEW index
```

### 2. Backend (`convex/receipts.ts`)

Modify `submitReceipt`:
- Accept optional `cashBalanceAmount` argument
- When provided, create TWO receipts:
  1. Zelle receipt (with storageId, receiptType: "zelle")
  2. Cash receipt (no storageId, receiptType: "cash", relatedReceiptId pointing to Zelle receipt)
- Link them via `relatedReceiptId`

Update `listPendingReceipts` and `getReceipt`:
- Return `receiptType`, `hasImage`, `relatedReceiptId`

### 3. Admin Verification (`convex/admin.ts`)

Update `verifyReceipt`:
- Check if ledgerItems are already verified (by related receipt)
- If yes, just mark receipt as verified without re-processing items
- This handles the case where Zelle is verified first, then cash later

### 4. Frontend - Checkout (`ReceiptUpload.tsx`)

```typescript
// In handleSubmit:
const cashBalance = isCashOption ? remainingBalance : undefined;
await submitReceipt({
  // ...existing args...
  cashBalanceAmount: cashBalance,  // NEW
});
```

### 5. Frontend - Admin Queue (`ReceiptQueue.tsx`)

Add visual badges:
- Zelle: Blue badge with icon
- Cash: Amber badge with icon
- Show "No image (cash)" indicator for cash receipts

### 6. Frontend - Admin Review (`ReceiptReview.tsx`)

Handle cash receipts:
- Show placeholder instead of image: "Cash Payment Expected - Verify when received in person"
- Display amount prominently
- Show link to related Zelle receipt

---

## Edge Cases

1. **Denial**: If Zelle deposit denied, cash receipt should also be denied (add to `denyReceipt`)
2. **Partial Verification**: First verified receipt marks ledgerItems as verified; second is just payment tracking
3. **Existing Data**: Handle existing receipts without `receiptType` (default to "zelle")
4. **Full Zelle**: No cash receipt created when user pays full amount via Zelle

---

## Verification Steps

1. **Test Cash Flow**:
   - Select cash option at checkout
   - Upload Zelle deposit receipt
   - Verify TWO receipts appear in admin queue (Zelle + Cash)

2. **Test Admin Queue**:
   - Verify cash receipts show amber badge, "No image" indicator
   - Verify Zelle receipts show blue badge with image

3. **Test Admin Review**:
   - Cash receipt shows placeholder instead of image
   - Link to related Zelle receipt works

4. **Test Verification**:
   - Verify Zelle receipt -> ledgerItems become "verified"
   - Verify cash receipt -> receipt marked verified, items unchanged (already verified)

5. **Test Full Zelle Flow**:
   - Select Zelle option -> only ONE receipt created
   - Existing flow unchanged


If you need specific details from before exiting plan mode (like exact code snippets, error messages, or content you generated), read the full transcript at: /Users/zimengx/.claude/projects/-Users-zimengx-Projects-berryFunv1/43d76c97-b186-47af-86eb-4c7e7c755280.jsonl

### 2. 2026-02-01 17:26

remove the blank space ont he front page of the website belwo the banner and before the bottom banner

### 3. 2026-02-01 17:27

no just make the banner at the bototm of the scren right now its not full height the entire page there whtie below the bottom bnaner make the main banner pink thing larger to fit the entire screen

